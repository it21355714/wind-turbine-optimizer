<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Wind Turbine Failure Dashboard</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #1f1f1f;
      color: #fff;
    }
    .container {
      max-width: 1200px;
      margin: auto;
      padding: 20px;
    }
    .card {
      background-color: #2c2c2c;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 30px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
    }
    h1, h2 {
      color: #fff;
    }
    label {
      font-weight: bold;
      margin-top: 15px;
      display: block;
    }
    input[type="number"] {
      width: 100%;
      padding: 8px 12px 8px 8px;
      margin-left: -10px;
      border: 1px solid #555;
      border-radius: 5px;
      background-color: #1f1f1f;
      color: white;
      margin-bottom: 10px;
    }
    button {
      background-color: #d4145a;
      color: white;
      padding: 12px 20px;
      margin: 10px 0;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      width: 100%;
    }
    button:hover {
      background-color: #ad1249;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      padding: 12px;
      border: 1px solid #444;
      text-align: center;
    }
    th {
      background-color: #111;
    }
    td {
      background-color: #333;
    }
    .status-success { color: #4caf50; font-weight: bold; }
    .status-fail { color: #ff5252; font-weight: bold; }
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <h1>Wind Turbine Operational Predictor</h1>
      <form id="predictionForm">
        <label>RPM</label><input type="number" name="rpm" required>
        <label>Torque</label><input type="number" name="torque" required>
        <label>Power Output</label><input type="number" name="power_out" required>
        <label>Generator Temperature (T1)</label><input type="number" name="t1" required>
        <label>Bearing Temperature (T2)</label><input type="number" name="t2" required>
        <label>Nacelle Temperature (T3)</label><input type="number" name="t3" required>
        <label>Event Count</label><input type="number" name="event_count" required>
        <label>Wind Speed Reference</label><input type="number" name="windspeed_ref" required>
        <label>Voltage L1</label><input type="number" name="voltage_L1" required>
        <label>Voltage L2</label><input type="number" name="voltage_L2" required>
        <label>Current Output</label><input type="number" name="current_out" required>
        <label>Event Status</label><input type="number" name="event_status" required>
        <label>Turbine Status</label><input type="number" name="turbine_status" required>

        <button type="submit">Predict</button>
        <button type="button" onclick="getHistory()">View History</button>
        <button type="button" onclick="deleteHistory()">Delete History</button>
      </form>
      <div id="result"></div>
    </div>

    <div class="card">
      <h2>Prediction History</h2>
      <div id="historyContainer">Click "View History" to load...</div>
    </div>
  </div>

  <script>
    const form = document.getElementById("predictionForm");
    const resultBox = document.getElementById("result");
    const historyBox = document.getElementById("historyContainer");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const data = Object.fromEntries(new FormData(form).entries());
      Object.keys(data).forEach(k => data[k] = parseFloat(data[k]));

      const res = await fetch("/predict", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      });

      const result = await res.json();
      if (result.error) {
        resultBox.innerHTML = `<p style="color:red;">‚ùå ${result.error}</p>`;
        return;
      }

      const issues = result.issues_detected;
      resultBox.innerHTML = `
        <h3 class="${result.status === 'Failure' ? 'status-fail' : 'status-success'}">${result.status}</h3>
        <p><strong>Message:</strong> ${result.message}</p>
        <p><strong>Overall Prediction:</strong> ${result.overall_prediction}</p>
        <p><strong>Component Analysis:</strong></p>
        <ul>
          ${Object.entries(issues).map(([k, v]) => `<li>${k}: ${v}</li>`).join('')}
        </ul>
      `;
    });

    async function getHistory() {
      const res = await fetch("/history");
      const data = await res.json();
      if (!data.history || data.history.length === 0) {
        historyBox.innerHTML = "<p>No history available.</p>";
        return;
      }
      let table = `
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>RPM</th>
              <th>Torque</th>
              <th>Power Out</th>
              <th>Status</th>
              <th>Failure</th>
              <th>Rotor</th>
              <th>Generator</th>
              <th>Temp</th>
              <th>Gearbox</th>
            </tr>
          </thead>
          <tbody>
      `;
      data.history.forEach(item => {
        table += `
          <tr>
            <td>${item.id}</td>
            <td>${item.rpm}</td>
            <td>${item.torque}</td>
            <td>${item.power_out}</td>
            <td>${item.overall_status}</td>
            <td class="${item.failure_detected === 'Yes' ? 'status-fail' : 'status-success'}">${item.failure_detected}</td>
            <td>${item.rotor_status}</td>
            <td>${item.generator_status}</td>
            <td>${item.temperature_status}</td>
            <td>${item.gearbox_status}</td>
          </tr>`;
      });
      table += `</tbody></table>`;
      historyBox.innerHTML = table;
    }

    async function deleteHistory() {
      if (!confirm("Are you sure you want to delete all history?")) return;
      const res = await fetch("/delete_history", { method: "DELETE" });
      const data = await res.json();
      alert(data.message);
      historyBox.innerHTML = "";
    }
  </script>
</body>
</html>
